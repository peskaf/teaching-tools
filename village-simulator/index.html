<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Village AI - Behavioral Tree Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Village AI Simulator</h1>
            <div class="time-controls">
                <div class="time-display">
                    <span class="day">Day 1</span> Â· <span class="time">06:00</span>
                </div>
                <div class="speed-controls">
                    <button class="speed-btn" data-speed="0">â¸</button>
                    <button class="speed-btn active" data-speed="1">1Ã—</button>
                    <button class="speed-btn" data-speed="2">2Ã—</button>
                    <button class="speed-btn" data-speed="5">5Ã—</button>
                    <button class="speed-btn" data-speed="10">10Ã—</button>
                </div>
            </div>
            <div class="sim-controls">
                <button class="sim-btn reset" onclick="resetSimulation()">ğŸ”„ Reset</button>
                <button class="sim-btn" id="startBtn" onclick="toggleSimulation()">â–¶ Start</button>
            </div>
        </header>

        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="side-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" data-tab="trees">ğŸŒ³ Trees</button>
                <button class="panel-tab" data-tab="status">ğŸ“Š Status</button>
                <button class="panel-tab" data-tab="help">â“ Help</button>
            </div>

            <div class="panel-content">
                <!-- Trees Panel -->
                <div class="panel-section active" id="treesPanel">
                    <div class="villager-select">
                        <!-- Villager buttons generated dynamically by ui.js -->
                    </div>

                    <div class="tree-editor">
                        <h3>ğŸ“ Behavior Tree</h3>
                        <div class="tree-container" id="treeContainer">
                            <!-- Tree will be rendered here -->
                        </div>
                    </div>

                    <div class="node-palette">
                        <h3>ğŸ§© Add Nodes</h3>
                        <p style="font-size: 0.75em; color: #888; margin-bottom: 10px;">Click a node below to add it to the tree</p>

                        <div class="palette-category">
                            <h4>Control Nodes</h4>
                            <div class="palette-nodes">
                                <div class="palette-node selector" data-type="selector" data-subtype="selector">â“ Selector</div>
                                <div class="palette-node sequence" data-type="sequence" data-subtype="sequence">â¡ï¸ Sequence</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Conditions - Basic</h4>
                            <div class="palette-nodes">
                                <div class="palette-node condition" data-type="condition" data-subtype="isNight">ğŸŒ™ Is Night?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isDay">â˜€ï¸ Is Day?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isTired">ğŸ˜´ Is Tired?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isHungry">ğŸ½ï¸ Is Hungry?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isCold">ğŸ¥¶ Is Cold?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isWinter">â„ï¸ Is Winter?</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Conditions - Inventory</h4>
                            <div class="palette-nodes">
                                <div class="palette-node condition" data-type="condition" data-subtype="hasItems">ğŸ’ Has Items?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasWheat">ğŸŒ¾ Has Wheat?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasFlour">ğŸ¥› Has Flour?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasWood">ğŸªµ Has Wood?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasWool">ğŸ§¶ Has Wool?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasFish">ğŸŸ Has Fish?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="wearingSweater">ğŸ§¥ Wearing Sweater?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="notWearingSweater">ğŸ§¥ Not Wearing Sweater?</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Conditions - World</h4>
                            <div class="palette-nodes">
                                <div class="palette-node condition" data-type="condition" data-subtype="cropsReady">ğŸŒ¾ Crops Ready?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="fieldEmpty">ğŸŸ« Field Empty?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="needsWater">ğŸ’§ Needs Water?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="treesAvailable">ğŸŒ² Trees Available?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="sheepHasWool">ğŸ‘ Sheep Has Wool?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="fireNotLit">ğŸ”¥ Fire Not Lit?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="fireLit">ğŸ”¥ Fire Lit?</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Conditions - Storage</h4>
                            <div class="palette-nodes">
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasWheat">ğŸ“¦ğŸŒ¾ Has Wheat?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasFlour">ğŸ“¦ğŸ¥› Has Flour?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasBread">ğŸ“¦ğŸ Has Bread?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasWood">ğŸ“¦ğŸªµ Has Wood?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasWool">ğŸ“¦ğŸ§¶ Has Wool?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasSweaters">ğŸ“¦ğŸ§¥ Has Sweaters?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasFish">ğŸ“¦ğŸŸ Has Fish?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasCookedFish">ğŸ“¦ğŸ³ Has Cooked Fish?</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Movement</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="goToField">ğŸš¶ Go to Field</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToFieldForWatering">ğŸš¶ Go to Field (Water)</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToHouse">ğŸ  Go to House</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToFireplace">ğŸ”¥ Go to Fireplace</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToStorage">ğŸ“¦ Go to Storage</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToWell">ğŸ’§ Go to Well</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToMill">ğŸ­ Go to Mill</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToForest">ğŸŒ² Go to Forest</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToPasture">ğŸ‘ Go to Pasture</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToPond">ğŸ£ Go to Pond</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Farming</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="plantCrops">ğŸŒ± Plant Crops</div>
                                <div class="palette-node action" data-type="action" data-subtype="harvestCrops">ğŸŒ¾ Harvest</div>
                                <div class="palette-node action" data-type="action" data-subtype="waterCrops">ğŸ’§ Water Crops</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Storage</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="storeItems">ğŸ“¥ Store Items</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupWheat">ğŸ“¤ Pickup Wheat</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupFlour">ğŸ“¤ Pickup Flour</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupWood">ğŸ“¤ Pickup Wood</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupWool">ğŸ“¤ Pickup Wool</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupFish">ğŸ“¤ Pickup Fish</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Processing</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="grindWheat">âš™ï¸ Grind Wheat</div>
                                <div class="palette-node action" data-type="action" data-subtype="bakeBread">ğŸ Bake Bread</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Woodcutting</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="chopTree">ğŸª“ Chop Tree</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Sheep & Wool</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="shearSheep">âœ‚ï¸ Shear Sheep</div>
                                <div class="palette-node action" data-type="action" data-subtype="knitSweater">ğŸ§¶ Knit Sweater</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Fishing</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="catchFish">ğŸ£ Catch Fish</div>
                                <div class="palette-node action" data-type="action" data-subtype="cookFish">ğŸ³ Cook Fish</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Eating</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="eatBread">ğŸ Eat Bread</div>
                                <div class="palette-node action" data-type="action" data-subtype="eatCookedFish">ğŸŸ Eat Fish</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Warmth</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="putOnSweater">ğŸ§¥ Put On Sweater</div>
                                <div class="palette-node action" data-type="action" data-subtype="takeOffSweater">ğŸ§¥ Take Off Sweater</div>
                                <div class="palette-node action" data-type="action" data-subtype="addWoodToFire">ğŸ”¥ Add Wood to Fire</div>
                                <div class="palette-node action" data-type="action" data-subtype="warmByFire">ğŸ”¥ Warm By Fire</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions - Rest</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="sleep">ğŸ˜´ Sleep</div>
                                <div class="palette-node action" data-type="action" data-subtype="rest">â˜• Rest</div>
                            </div>
                        </div>

                        <div class="legend">
                            <div class="legend-item"><div class="legend-color" style="background:#9b59b6"></div> Selector: Try until success</div>
                            <div class="legend-item"><div class="legend-color" style="background:#3498db"></div> Sequence: Do all in order</div>
                        </div>
                    </div>
                </div>

                <!-- Status Panel -->
                <div class="panel-section" id="statusPanel">
                    <div class="objectives-section">
                        <h3>ğŸ¯ Objectives</h3>
                        <div id="objectives">
                            <div class="objective" data-objective="survive7">
                                <span class="objective-check">â˜</span>
                                <span class="objective-text">Survive 7 days (1 season)</span>
                            </div>
                            <div class="objective" data-objective="bread5">
                                <span class="objective-check">â˜</span>
                                <span class="objective-text">Bake 5 loaves of bread</span>
                            </div>
                            <div class="objective" data-objective="sweater3">
                                <span class="objective-check">â˜</span>
                                <span class="objective-text">Knit 3 sweaters</span>
                            </div>
                            <div class="objective" data-objective="fish5">
                                <span class="objective-check">â˜</span>
                                <span class="objective-text">Cook 5 fish</span>
                            </div>
                            <div class="objective" data-objective="surviveWinter">
                                <span class="objective-check">â˜</span>
                                <span class="objective-text">Survive through winter</span>
                            </div>
                            <div class="objective" data-objective="allFed">
                                <span class="objective-check">â˜</span>
                                <span class="objective-text">Keep all villagers fed for a full day</span>
                            </div>
                        </div>
                    </div>

                    <div class="status-section">
                        <h3>ğŸ‘¥ Villagers</h3>
                        <div id="villagerStatuses"></div>
                    </div>

                    <div class="world-stats">
                        <h3>ğŸŒ Village Stats</h3>
                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="value" id="statWheat">0</div>
                                <div class="label">ğŸŒ¾ Wheat</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statFlour">0</div>
                                <div class="label">ğŸ¥› Flour</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statBread">0</div>
                                <div class="label">ğŸ Bread</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statWood">0</div>
                                <div class="label">ğŸªµ Wood</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statWool">0</div>
                                <div class="label">ğŸ§¶ Wool</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statSweaters">0</div>
                                <div class="label">ğŸ§¥ Sweaters</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statFish">0</div>
                                <div class="label">ğŸŸ Fish</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statFire">â„ï¸ Out</div>
                                <div class="label">ğŸ”¥ Fireplace</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statSeason">spring</div>
                                <div class="label">ğŸŒ¸ Season</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statPlanted">0</div>
                                <div class="label">Fields Planted</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statHarvested">0</div>
                                <div class="label">Total Harvested</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statDays">1</div>
                                <div class="label">Days Passed</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help Panel -->
                <div class="panel-section" id="helpPanel">
                    <div class="instructions">
                        <h3>ğŸ® How to Play</h3>
                        <p>Design behavior trees for each villager to automate their daily tasks. Each villager can have a specialized role!</p>

                        <h3 style="margin-top: 15px;">ğŸ‘¥ Villager Roles</h3>
                        <ul>
                            <li><strong>ğŸ‘¨â€ğŸŒ¾ Farmer</strong> - Plants, waters, harvests crops</li>
                            <li><strong>ğŸ‘©â€ğŸŒ¾ Miller</strong> - Grinds wheat, bakes bread</li>
                            <li><strong>ğŸª“ Lumberjack</strong> - Chops trees for wood</li>
                            <li><strong>ğŸ‘ Shepherd</strong> - Shears sheep, knits sweaters</li>
                            <li><strong>ğŸ£ Fisher</strong> - Catches and cooks fish</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸŒ³ Behavior Trees</h3>
                        <p>Trees are evaluated from top to bottom each tick:</p>
                        <ul>
                            <li><strong>Selector (â“)</strong> - Tries children until one succeeds</li>
                            <li><strong>Sequence (â¡ï¸)</strong> - Runs all children in order, stops on failure</li>
                            <li><strong>Condition</strong> - Checks if something is true</li>
                            <li><strong>Action</strong> - Makes the villager do something</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸŒ¡ï¸ Seasons & Temperature</h3>
                        <p>The year cycles through 4 seasons (7 days each):</p>
                        <ul>
                            <li>ğŸŒ¸ <strong>Spring</strong> - Mild temperature</li>
                            <li>â˜€ï¸ <strong>Summer</strong> - Warm, crops grow fastest</li>
                            <li>ğŸ‚ <strong>Autumn</strong> - Cooling down</li>
                            <li>â„ï¸ <strong>Winter</strong> - Crops don't grow! Villagers get cold!</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ¥¶ Warmth System</h3>
                        <p>Villagers need to stay warm, especially in winter!</p>
                        <ul>
                            <li>Warmth drains faster in winter</li>
                            <li>ğŸ§¥ <strong>Sweaters</strong> reduce warmth loss</li>
                            <li>ğŸ”¥ <strong>Fireplace</strong> restores warmth (needs wood!)</li>
                            <li>Cold villagers move slower and may freeze!</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ Food Production</h3>
                        <p>Two ways to get food:</p>
                        <ul>
                            <li><strong>Bread:</strong> Plant â†’ Water â†’ Harvest â†’ Mill â†’ Bake</li>
                            <li><strong>Fish:</strong> Catch â†’ Cook (needs lit fire!)</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸªµ Wood & Fire</h3>
                        <ul>
                            <li>Chop trees in the forest for wood</li>
                            <li>Add wood to fireplace to light it</li>
                            <li>Fire is needed for cooking fish and baking</li>
                            <li>Fire consumes wood over time!</li>
                            <li>Trees regrow after being chopped</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ§¶ Wool & Sweaters</h3>
                        <ul>
                            <li>Shear sheep at the pasture for wool</li>
                            <li>Knit sweaters to stay warm in winter</li>
                            <li>Sheep regrow wool over time</li>
                        </ul>

                        <h3 style="margin-top: 15px;">â° Time</h3>
                        <p><code>06:00-20:00</code> = Day</p>
                        <p><code>20:00-06:00</code> = Night</p>
                        <p>1 season = 7 days. Prepare for winter!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initGame } from './game.js';
        initGame();
    </script>
</body>
</html>

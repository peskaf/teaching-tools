<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Village AI - Behavioral Tree Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Village AI Simulator</h1>
            <div class="time-controls">
                <div class="time-display">
                    <span class="day">Day 1</span> Â· <span class="time">06:00</span>
                </div>
                <div class="speed-controls">
                    <button class="speed-btn" data-speed="0">â¸</button>
                    <button class="speed-btn active" data-speed="1">1Ã—</button>
                    <button class="speed-btn" data-speed="2">2Ã—</button>
                    <button class="speed-btn" data-speed="5">5Ã—</button>
                    <button class="speed-btn" data-speed="10">10Ã—</button>
                </div>
            </div>
            <div class="sim-controls">
                <button class="sim-btn reset" onclick="resetSimulation()">ğŸ”„ Reset</button>
                <button class="sim-btn" id="startBtn" onclick="toggleSimulation()">â–¶ Start</button>
            </div>
        </header>

        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="side-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" data-tab="trees">ğŸŒ³ Trees</button>
                <button class="panel-tab" data-tab="status">ğŸ“Š Status</button>
                <button class="panel-tab" data-tab="help">â“ Help</button>
            </div>

            <div class="panel-content">
                <!-- Trees Panel -->
                <div class="panel-section active" id="treesPanel">
                    <div class="villager-select">
                        <button class="villager-btn active" data-villager="0">
                            <span class="emoji">ğŸ‘¨â€ğŸŒ¾</span>
                            Karel
                        </button>
                        <button class="villager-btn" data-villager="1">
                            <span class="emoji">ğŸ‘©â€ğŸŒ¾</span>
                            Marie
                        </button>
                        <button class="villager-btn" data-villager="2">
                            <span class="emoji">ğŸ‘¦</span>
                            TomÃ¡Å¡
                        </button>
                    </div>

                    <div class="tree-editor">
                        <h3>ğŸ“ Behavior Tree</h3>
                        <div class="tree-container" id="treeContainer">
                            <!-- Tree will be rendered here -->
                        </div>
                    </div>

                    <div class="node-palette">
                        <h3>ğŸ§© Add Nodes</h3>
                        <p style="font-size: 0.75em; color: #888; margin-bottom: 10px;">Click a node below to add it to the tree</p>

                        <div class="palette-category">
                            <h4>Control Nodes</h4>
                            <div class="palette-nodes">
                                <div class="palette-node selector" data-type="selector" data-subtype="selector">â“ Selector</div>
                                <div class="palette-node sequence" data-type="sequence" data-subtype="sequence">â¡ï¸ Sequence</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Conditions</h4>
                            <div class="palette-nodes">
                                <div class="palette-node condition" data-type="condition" data-subtype="isNight">ğŸŒ™ Is Night?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isDay">â˜€ï¸ Is Day?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isTired">ğŸ˜´ Is Tired?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="isHungry">ğŸ½ï¸ Is Hungry?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasItems">ğŸ’ Has Items?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasWheat">ğŸŒ¾ Has Wheat?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="hasFlour">ğŸ¥› Has Flour?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="cropsReady">ğŸŒ¾ Crops Ready?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="fieldEmpty">ğŸŸ« Field Empty?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="needsWater">ğŸ’§ Needs Water?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasWheat">ğŸ“¦ğŸŒ¾ Storage Has Wheat?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasFlour">ğŸ“¦ğŸ¥› Storage Has Flour?</div>
                                <div class="palette-node condition" data-type="condition" data-subtype="storageHasBread">ğŸ“¦ğŸ Storage Has Bread?</div>
                            </div>
                        </div>

                        <div class="palette-category">
                            <h4>Actions</h4>
                            <div class="palette-nodes">
                                <div class="palette-node action" data-type="action" data-subtype="goToField">ğŸš¶ Go to Field</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToFieldForWatering">ğŸš¶ Go to Field (Water)</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToHouse">ğŸ  Go to House</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToStorage">ğŸ“¦ Go to Storage</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToWell">ğŸ’§ Go to Well</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToMill">ğŸ­ Go to Mill</div>
                                <div class="palette-node action" data-type="action" data-subtype="goToKitchen">ğŸ³ Go to Kitchen</div>
                                <div class="palette-node action" data-type="action" data-subtype="plantCrops">ğŸŒ± Plant Crops</div>
                                <div class="palette-node action" data-type="action" data-subtype="harvestCrops">ğŸŒ¾ Harvest</div>
                                <div class="palette-node action" data-type="action" data-subtype="waterCrops">ğŸ’§ Water Crops</div>
                                <div class="palette-node action" data-type="action" data-subtype="storeItems">ğŸ“¥ Store Items</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupWheat">ğŸ“¤ Pickup Wheat</div>
                                <div class="palette-node action" data-type="action" data-subtype="pickupFlour">ğŸ“¤ Pickup Flour</div>
                                <div class="palette-node action" data-type="action" data-subtype="grindWheat">âš™ï¸ Grind Wheat</div>
                                <div class="palette-node action" data-type="action" data-subtype="bakeBread">ğŸ Bake Bread</div>
                                <div class="palette-node action" data-type="action" data-subtype="eatBread">ğŸ Eat Bread</div>
                                <div class="palette-node action" data-type="action" data-subtype="sleep">ğŸ˜´ Sleep</div>
                                <div class="palette-node action" data-type="action" data-subtype="rest">â˜• Rest</div>
                            </div>
                        </div>

                        <div class="legend">
                            <div class="legend-item"><div class="legend-color" style="background:#9b59b6"></div> Selector: Try until success</div>
                            <div class="legend-item"><div class="legend-color" style="background:#3498db"></div> Sequence: Do all in order</div>
                        </div>
                    </div>
                </div>

                <!-- Status Panel -->
                <div class="panel-section" id="statusPanel">
                    <div class="status-section">
                        <h3>ğŸ‘¥ Villagers</h3>
                        <div id="villagerStatuses"></div>
                    </div>

                    <div class="world-stats">
                        <h3>ğŸŒ Village Stats</h3>
                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="value" id="statWheat">0</div>
                                <div class="label">ğŸŒ¾ Wheat</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statFlour">0</div>
                                <div class="label">ğŸ¥› Flour</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statBread">0</div>
                                <div class="label">ğŸ Bread</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statPlanted">0</div>
                                <div class="label">Fields Planted</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statHarvested">0</div>
                                <div class="label">Total Harvested</div>
                            </div>
                            <div class="stat-item">
                                <div class="value" id="statDays">1</div>
                                <div class="label">Days Passed</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help Panel -->
                <div class="panel-section" id="helpPanel">
                    <div class="instructions">
                        <h3>ğŸ® How to Play</h3>
                        <p>Design behavior trees for each villager to automate their daily tasks in the village.</p>

                        <h3 style="margin-top: 15px;">ğŸŒ³ Behavior Trees</h3>
                        <p>Trees are evaluated from top to bottom each tick:</p>
                        <ul>
                            <li><strong>Selector (â“)</strong> - Tries children until one succeeds</li>
                            <li><strong>Sequence (â¡ï¸)</strong> - Runs all children in order, stops on failure</li>
                            <li><strong>Condition</strong> - Checks if something is true</li>
                            <li><strong>Action</strong> - Makes the villager do something</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ’§ Watering System</h3>
                        <p>Crops need water to grow!</p>
                        <ul>
                            <li>After planting, crops need to be watered</li>
                            <li>Crops only grow while watered</li>
                            <li>Water runs out after ~3 hours, re-water to continue growth</li>
                            <li>Look for the ğŸ’§ icon on dry crops</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ Production Cycle</h3>
                        <p>Full cycle: Wheat â†’ Flour â†’ Bread â†’ Eat</p>
                        <ul>
                            <li>ğŸŒ¾ <strong>Harvest wheat</strong> from ready crops</li>
                            <li>ğŸ“¥ <strong>Store wheat</strong> at the storage</li>
                            <li>ğŸ“¤ <strong>Pickup wheat</strong> from storage</li>
                            <li>ğŸ­ <strong>Go to mill</strong> and <strong>Grind wheat</strong> into flour</li>
                            <li>ğŸ“¤ <strong>Pickup flour</strong> from storage</li>
                            <li>ğŸ³ <strong>Go to kitchen</strong> and <strong>Bake bread</strong></li>
                            <li>ğŸ <strong>Eat bread</strong> when hungry to restore hunger</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ½ï¸ Hunger System</h3>
                        <p>Villagers get hungry over time!</p>
                        <ul>
                            <li>Hunger decreases slowly over time</li>
                            <li>When hunger drops below 40%, villagers become hungry</li>
                            <li>Eating bread restores 40 hunger points</li>
                            <li>Very hungry villagers move slower!</li>
                        </ul>

                        <h3 style="margin-top: 15px;">ğŸ“‹ Example Tree</h3>
                        <p>A complete farming routine:</p>
                        <ul>
                            <li>Selector (root)
                                <ul>
                                    <li>Sequence: Sleep at night
                                        <ul>
                                            <li>Condition: Is Night?</li>
                                            <li>Action: Go to House</li>
                                            <li>Action: Sleep</li>
                                        </ul>
                                    </li>
                                    <li>Sequence: Store crops
                                        <ul>
                                            <li>Condition: Has Items?</li>
                                            <li>Action: Go to Storage</li>
                                            <li>Action: Store Items</li>
                                        </ul>
                                    </li>
                                    <li>Sequence: Harvest
                                        <ul>
                                            <li>Condition: Crops Ready?</li>
                                            <li>Action: Go to Field</li>
                                            <li>Action: Harvest</li>
                                        </ul>
                                    </li>
                                    <li>Sequence: Water crops
                                        <ul>
                                            <li>Condition: Needs Water?</li>
                                            <li>Action: Go to Well</li>
                                            <li>Action: Go to Field</li>
                                            <li>Action: Water Crops</li>
                                        </ul>
                                    </li>
                                    <li>Sequence: Plant
                                        <ul>
                                            <li>Condition: Field Empty?</li>
                                            <li>Action: Go to Field</li>
                                            <li>Action: Plant Crops</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                        <h3 style="margin-top: 15px;">â° Time</h3>
                        <p><code>06:00-20:00</code> = Day</p>
                        <p><code>20:00-06:00</code> = Night</p>
                        <p>Crops take ~4 hours to grow (when watered). Villagers get tired over time.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initGame } from './game.js';
        initGame();
    </script>
</body>
</html>
